# Private Chat 구현하기(DM)

## 앱 기본 구조 생성

- private-chat-app 생성

  - public / src 디렉토리 및 기본 파일 생성

  ```shell
  $npm init -y
  ```

<br />

- 모듈 설치

  ```shell
  $npm i express mongoose socket.io
  ```

  ```shell
  $npm i -D nodemon
  ```

<br />

- express 앱 생성 및 정적 파일 제공, 미들웨어 등록

  ```js
  const express = require("express");
  const path = require("path");

  const app = express();

  const publicDirectory = path.join(__dirname, "../public");
  app.use(express.static(publicDirectory));
  app.use(express.json());

  const PORT = 4000;
  app.listen(PORT, () => {
    console.log(`Server is up on port ${PORT}`);
  });
  ```

<br />

- HTML 기본 구조 작성

  - 부트스트랩5 CDN으로 스타일링 코드 작성

  ```html
  <!DOCTYPE html>
  <html lang="ko">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT"
        crossorigin="anonymous"
      />

      <title>Chat App</title>
      <link rel="stylesheet" href="./style.css" />
    </head>
    <body>
      <script src="/socket.io/socket.io.js"></script>
      <script src="./main.js"></script>
    </body>
  </html>
  ```

<br />

## 앱 기본 UI 생성하기

- index.html 코드 확인

<br />

## Socket IO 연동하기

- Express App에 Socket IO 연동

  ```js
  const express = require("express");
  const path = require("path");
  const app = express();

  const http = require("http");
  const { Server } = require("socket.io");
  const server = http.createServer(app);
  const io = new Server(server);

  const publicDirectory = path.join(__dirname, "../public");
  app.use(express.static(publicDirectory));
  app.use(express.json());

  const PORT = 4000;
  server.listen(PORT, () => {
    console.log(`Server is up on port ${PORT}`);
  });
  ```

<br />

- Server WebSocket 인스턴스에 이벤트 핸들러 구조 생성

  ```js
  let users = [];
  io.on("connection", async (socket) => {
    let userData = {};
    users.push(userData);
    io.emit("users-data", { users });

    // client에서 보내온 메시지
    socket.on("message-to-server", () => {});

    // 데이터베이스에서 메시지 가져오기
    socket.on("fetch-messages", () => {});

    // 유저가 방에서 나갔을 때
    socket.on("disconnect", () => {});
  });
  ```

<br />

- Client에서 socket 코드 작성

```js
const socket = io("http://localhost:4000", {
  autoConnect: false
});

socket.onAny((e, ...arg) => {
  console.log(e, ...arg);
});
```

<br />

- Client 전역변수 생성

```js
// Global Variables
const chatBody = document.querySelector(".chat-body");
const userTitle = document.querySelector(".user-title");
const loginContainer = document.querySelector(".login-container");
const userTable = document.querySelector(".users");
const userTagline = document.querySelector("#users-tagline");
const title = document.querySelector("#active-user");
const messages = document.querySelector(".messages");
const msgDiv = document.querySelector(".msg-form");
```

<br />

## 몽고 DB 연동하기

- mongoose, dotenv 설치

  ```shell
  $npm i mongoose dotenv
  ```

<br />

- mongoose 사용해 MongoDB Atlas 연동

  ```js
  const { default: mongoose } = require("mongoose");
  require("dotenv").config();

  mongoose.set("strictQuery", false);
  mongoose
    .connect(process.env.MONGO_URI)
    .then(() => {
      console.log("DB 연결 성공");
    })
    .catch((err) => console.error(err));
  ```

<br />

- message 모델 생성

```js

```

<br />

## 유저 세션 생성하기

<br />

## 유저 세션 생성 코드 작성하기

<br />

## 메시지 보낼 상대 선택하기

<br />

## 메시지 보내기

<br />

## 서버에서 클라이언트로 메시지 전달하기

<br />

## 채팅방 나가는 로직 구현하기

<br />

## 데이터베이스에서 메시지 가져오기

<br />

## 채팅앱 스타일링 해주기
